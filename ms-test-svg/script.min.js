var draw,triangle,circle,circleEl,triangleEl,gameInterval,dx,dy,notification,gameStarted=!1,gamePaused=!1,dMin=.05,dMax=5,v=10;function initField(){draw=SVG("drawing").size(400,400),triangle=draw.path("M0,400 400,400 200,0z").id("triangle").fill("#02440c").size(window.innerWidth,window.innerHeight),triangleEl=$("#triangle")}function initBall(){circle=draw.path("M-20,0a20,20 0 1,0 40,0a20,20 0 1,0 -40,0").id("circle"),circleEl=$("#circle")}function placeBall(){var i,t,e=triangle.width(),a=triangle.height();do{i=Math.floor(Math.random()*e)+1,t=Math.floor(Math.random()*a)+1,circle.x(i).y(t)}while(!ballInsideField());circle.fill("#e4d565")}function ballInsideField(){return Snap.path.isPointInside(triangleEl.attr("d"),circle.x(),circle.y())&&!Snap.path.intersection(triangleEl.attr("d"),circleEl.attr("d")).length}function generateVelocity(){dx=(Math.floor(Math.random()*(100*dMax-100*dMin+1))+100*dMin)/100*(1==Math.floor(2*Math.random())?1:-1),dy=(Math.floor(Math.random()*(100*dMax-100*dMin+1))+100*dMin)/100*(1==Math.floor(2*Math.random())?1:-1)}function resizeField(){triangle.size(window.innerWidth,window.innerHeight),triangleEl&&circleEl&&checkCollision()}function collision(){return!!Snap.path.intersection(triangleEl.attr("d"),circleEl.attr("d")).length}function checkCollision(){collision()&&(Math.abs(dx)>dMin||Math.abs(dy)>dMin?(dx=parseFloat((.95*dx).toFixed(3)),(dy=parseFloat((.95*dy).toFixed(3)))<0&&dx<0||dy>0&&dx>0?dy*=-1:dx*=-1):(stopGame(),notification.text("").text("Your ball lost its velocity. Please click or tap to restart.")))}function gameLoop(){generateVelocity(),placeBall(),gameStarted=!0,gamePaused=!1,notification.text(""),gameInterval=setInterval(function(){var i=circle.x()+dx,t=circle.y()+dy;circle.x(i).y(t),checkCollision()},v)}function stopGame(){clearInterval(gameInterval),gamePaused=!0}window.onload=function(){initField(),notification=$("#notification p"),$(window).on("resize",function(){resizeField(),gameStarted&&!ballInsideField()&&(stopGame(),notification.text().length||notification.text("Your game was paused because of resizing a window too fast. Please click or tap to restart."))}),$(window).on("click",function(){gameStarted?(gamePaused&&gameLoop(),generateVelocity()):(initBall(),gameLoop())})};